var $jscomp$this=this,mysql=require("mysql"),extractor=require("./extractor"),Connection=require("mysql/lib/Connection");function Pooler(){this.pool||(this.pool=null)}Pooler.prototype.pool=function(){if($jscomp$this.pool)return $jscomp$this.pool;throw Error("MySql Pooler Not Init");};
Pooler.prototype.setup=function(h,f,k){var e=f&&"debug"===f,g=null;$jscomp$this.pool=mysql.createPool(h);g=$jscomp$this.pool.query;$jscomp$this.logger=k;var c=$jscomp$this;$jscomp$this.pool.query=function(d,b,a){return g.call(this,d,b,function(d,b,c){b&&Array.isArray(b)&&(b=extractor(b));a(d,b,c)})};var l=$jscomp$this.pool.getConnection;$jscomp$this.pool.getConnection=function(d){l.call(this,function(b,a){var c=a.query;a._tType||(a._tType=1,a.query=function(b,a,d){c.call(this,b,a,function(b,a,c){a&&
Array.isArray(a)&&(a=extractor(a));d(b,a,c)})});d(b,a)})};$jscomp$this.pool.config.connectionConfig.queryFormat=function(d,b){var a="";if(!b)return e&&(c.logger?(c.logger.debug("[MySqL] Query Arguments ---\x3e Empty"),c.logger.debug("[MySqL] Query Statement ---\x3e\n"+d)):(console.log("\u00a7\u00a7 Query Arguments ---\x3e Empty"),console.log("\u00a7\u00a7 Query Statement ---\x3e\n"+d))),d;e&&(c.logger?(c.logger.debug("[MySqL] Query Arguments ---\x3e Empty"),c.logger.debug("[MySqL] Query Pre Statement ---\x3e\n"+
d)):(console.log("\u00a7\u00a7 Query Arguments ---\x3e "+JSON.stringify(b)),console.log("\u00a7\u00a7 Query Pre Statement ---\x3e\n"+d)));a=mysql.format(d,b);Array.isArray(b)||(a=a.replace(/\:(\w+)/g,function(a,c){return b.hasOwnProperty(c)?this.escape(b[c]):a}.bind(this)));e&&(c.logger?c.logger.debug("[MySqL] Query After Statement ---\x3e\n"+a):console.log("\u00a7\u00a7 Query After Statement ---\x3e\n"+a));return a};return $jscomp$this.pool};module.exports=new Pooler;